<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auto Loan Calculator — Fixvity</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --accent:#1e6fb8;
      --muted:#6b7280;
      --card:#ffffff;
      --bg:#f6fbff;
      --radius:12px;
      --shadow:0 6px 18px rgba(7,22,40,.06);
      --form-gap:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;color:#111;background:var(--bg);-webkit-font-smoothing:antialiased}
    .wrap{max-width:980px;margin:18px auto;padding:18px}
    h1{font-size:38px;margin:8px 0;color:var(--accent)}
    p.lead{margin:0 0 18px;color:var(--muted)}

    /* card */
    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);margin-bottom:18px}

    /* form grid */
    .form-grid{display:grid;grid-template-columns:1fr;gap:var(--form-gap)}
    @media(min-width:720px){ .form-grid{grid-template-columns:1fr 420px} }

    /* left form area */
    .form-left{padding-right:12px}
    .form-right{padding-left:12px}

    /* two-column rows inside form-left */
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:10px}
    .form-row.single{grid-template-columns:1fr}
    @media(max-width:420px){ .form-row{grid-template-columns:1fr} }

    label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px}
    input[type="number"], input[type="text"], select{
      width:100%;padding:12px;border-radius:8px;border:1px solid #e6eef8;background:#fff;font-size:16px
    }
    .small{font-size:13px;color:var(--muted);margin-top:6px}

    /* action row placed under fees */
    .action-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px;justify-content:flex-start}
    .btn{min-width:120px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:600;background:var(--accent);color:#fff}
    .btn.alt{background:#eef6fb;color:var(--accent);border:1px solid #cfe8fb}
    @media(max-width:420px){ .btn{min-width:48%;flex:1} .action-row{justify-content:space-between} }

    /* results */
    .results{margin-top:18px;display:grid;grid-template-columns:1fr;gap:12px}
    .totals{display:flex;gap:10px;flex-wrap:wrap}
    .tile{flex:1;background:#f8fbff;border-radius:8px;padding:12px;border:1px solid #eef6fb}
    .tile h3{margin:0;font-size:18px;color:var(--muted)}
    .tile p{margin:6px 0 0;font-size:20px;color:var(--accent);font-weight:700}

    /* chart card */
    .chart-wrap{background:#fff;border-radius:12px;padding:12px;box-shadow:var(--shadow)}
    canvas{max-width:100%!important;height:auto!important}

    /* amortization table */
    .schedule-header{display:flex;gap:12px;align-items:center;margin:8px 0}
    .schedule-tabs{margin-left:auto;display:flex;gap:8px}
    .tab{padding:8px 12px;border-radius:8px;border:1px solid #dbeefb;background:#f3f9ff;color:var(--accent);cursor:pointer}
    .tab.active{background:var(--accent);color:#fff}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;border-bottom:1px solid #f3f6fa;text-align:left}
    th{background:#2b6ba8;color:#fff;font-weight:700}
    .center{text-align:center}

    /* print styles */
    @media print{
      body{background:#fff}
      .action-row,.no-print{display:none}
      .card{box-shadow:none;border:0}
    }

    /* small helper */
    .muted{color:var(--muted);font-size:13px}
    .right{text-align:right}
  </style>
</head>
<body>
  <div class="wrap">

    <header>
      <h1>Auto Loan Calculator</h1>
      <p class="lead">Monthly payment, amortization schedule, charts, and printable results. Select currency and view annual or monthly breakdowns.</p>
    </header>

    <div class="card">
      <div class="form-grid">

        <!-- LEFT: form -->
        <div class="form-left">
          <!-- Currency -->
          <div class="form-row single">
            <div>
              <label for="currency">Currency & Format</label>
              <select id="currency">
                <option value="USD">$ USD</option>
                <option value="EUR">€ EUR</option>
                <option value="GBP">£ GBP</option>
                <option value="CAD">$ CAD</option>
                <option value="JPY">¥ JPY</option>
                <option value="INR">₹ INR</option>
              </select>
              <div class="small">Exchange rates are example values — change them in code if needed.</div>
            </div>
          </div>

          <div class="form-row single">
            <div class="form-group">
              <label for="amount">Auto Price</label>
              <input id="amount" type="number" step="0.01" value="50000" />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="months">Loan Term (months)</label>
              <input id="months" type="number" value="60" />
            </div>
            <div>
              <label for="rate">Interest Rate (%)</label>
              <input id="rate" type="number" step="0.001" value="5" />
            </div>
          </div>

          <div class="form-row single">
            <div>
              <label for="cash">Cash incentives</label>
              <input id="cash" type="number" value="0" />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="down">Down Payment</label>
              <input id="down" type="number" value="10000" />
            </div>
            <div>
              <label for="trade">Trade-in Value</label>
              <input id="trade" type="number" value="0" />
            </div>
          </div>

          <div class="form-row single">
            <div>
              <label for="owed">Amount Owed on Trade</label>
              <input id="owed" type="number" value="0" />
            </div>
          </div>

          <div class="form-row">
            <div>
              <label for="salesTax">Sales Tax (%)</label>
              <input id="salesTax" type="number" step="0.01" value="7" />
            </div>
            <div>
              <label for="fees">Title / Registration / Fees ($)</label>
              <input id="fees" type="number" value="2000" />
            </div>
          </div>

          <!-- ACTION BUTTONS moved here below the form inputs -->
          <div class="action-row no-print">
            <button class="btn" id="calc">Calculate</button>
            <button class="btn alt" id="reset">Reset</button>
            <button class="btn alt" id="printBtn">Print</button>
            <button class="btn alt" id="csv">Download CSV</button>
          </div>

          <div class="small muted" style="margin-top:10px">
            Notes: Fees/tax are included in the loan calculation by default for consistent totals. Edit code if you want alternate behavior.
          </div>
        </div>

        <!-- RIGHT: results / chart -->
        <div class="form-right">
          <div id="resultsArea" class="card">
            <div class="totals">
              <div class="tile">
                <h3>Vehicle Price</h3>
                <p id="outPrice">$50,000.00</p>
              </div>
              <div class="tile">
                <h3>Total Loan Amount</h3>
                <p id="outLoan">$40,000.00</p>
              </div>
              <div class="tile">
                <h3>Monthly Payment</h3>
                <p id="outPayment">$900.00</p>
              </div>
            </div>

            <div style="margin-top:12px" class="chart-wrap">
              <canvas id="loanChart" aria-label="Loan chart"></canvas>
            </div>

            <div class="schedule-header">
              <h3 style="margin:0">Amortization schedule</h3>
              <div class="schedule-tabs">
                <div class="tab active" id="tabAnnual">Annual Schedule</div>
                <div class="tab" id="tabMonthly">Monthly Schedule</div>
              </div>
            </div>

            <div id="scheduleArea">
              <table id="scheduleTable" role="table">
                <thead>
                  <tr>
                    <th>Period</th>
                    <th>Interest</th>
                    <th>Principal</th>
                    <th>Ending Balance</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

          </div>
        </div>

      </div>
    </div>

  </div>

<script>
/* ---------------------------
 Example exchange rates (edit)
 --------------------------- */
const exchangeRates = {
  USD: 1,
  EUR: 0.92,
  GBP: 0.79,
  CAD: 1.36,
  JPY: 154,
  INR: 83
};

/* Formatting helpers */
function formatCurrency(val, currency){
  const rates = exchangeRates;
  const rate = rates[currency] || 1;
  const amount = Number(val) * rate;
  let symbol = '$';
  if(currency==='EUR') symbol = '€';
  if(currency==='GBP') symbol = '£';
  if(currency==='CAD') symbol = '$';
  if(currency==='JPY') symbol = '¥';
  if(currency==='INR') symbol = '₹';
  // use en-US formatting, fallback simple
  return symbol + Number(amount).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
}

/* DOM */
const el = id => document.getElementById(id);
const amountEl = el('amount'), monthsEl = el('months'), rateEl = el('rate'),
      cashEl = el('cash'), downEl = el('down'), tradeEl = el('trade'), owedEl = el('owed'),
      salesTaxEl = el('salesTax'), feesEl = el('fees'), currencyEl = el('currency');

const outPrice = el('outPrice'), outLoan = el('outLoan'), outPayment = el('outPayment'),
      scheduleTableBody = document.querySelector('#scheduleTable tbody');

const calcBtn = el('calc'), resetBtn = el('reset'), printBtn = el('printBtn'), csvBtn = el('csv');

let chart = null;

/* Calculate loan */
function calculateAndRender(){
  const P_price = parseFloat(amountEl.value) || 0;
  const months = Math.max(1, parseInt(monthsEl.value) || 0);
  const annualRate = parseFloat(rateEl.value) || 0;
  const monthlyRate = annualRate/100/12;
  const cash = parseFloat(cashEl.value) || 0;
  const down = parseFloat(downEl.value) || 0;
  const trade = parseFloat(tradeEl.value) || 0;
  const owed = parseFloat(owedEl.value) || 0;
  const taxPercent = parseFloat(salesTaxEl.value) || 0;
  const fees = parseFloat(feesEl.value) || 0;
  const currency = currencyEl.value || 'USD';

  // Effective price adjustments
  const netPrice = P_price - cash - down - trade + owed;
  // tax on price
  const taxAmount = (taxPercent/100) * P_price;
  // Loan amount includes fees and tax (common approach)
  const loanAmount = Math.max(0, netPrice + taxAmount + fees);

  // monthly payment formula (fixed)
  let monthlyPayment;
  if(monthlyRate === 0) {
    monthlyPayment = loanAmount / months;
  } else {
    monthlyPayment = loanAmount * (monthlyRate / (1 - Math.pow(1 + monthlyRate, -months)));
  }

  // Build amortization arrays
  const schedule = [];
  let balance = loanAmount;
  let totalInterest = 0, totalPrincipal = 0;
  for(let m=1;m<=months;m++){
    let interest = balance * monthlyRate;
    let principal = monthlyPayment - interest;
    // handle last payment rounding
    if(m===months){
      principal = balance;
      monthlyPayment = principal + interest;
    }
    balance = Math.max(0, balance - principal);
    totalInterest += interest;
    totalPrincipal += principal;
    schedule.push({
      period: m,
      interest, principal, balance
    });
  }

  // Update header outputs (formatted)
  outPrice.textContent = formatCurrency(P_price, currency);
  outLoan.textContent = formatCurrency(loanAmount, currency);
  outPayment.textContent = formatCurrency(monthlyPayment, currency);

  // Render chart (Balance, Interest, Payment)
  renderChart(schedule, currency);

  // Render table — default shows annual summary
  renderAnnual(schedule, currency);
}

/* Chart: show balance, interest & payment over months */
function renderChart(schedule, currency){
  const labels = schedule.map(s => s.period);
  const balanceData = schedule.map(s => s.balance);
  const interestData = schedule.map(s => s.interest);
  const paymentData = schedule.map(s => s.interest + s.principal);

  const ctx = document.getElementById('loanChart').getContext('2d');
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets:[
        {label:'Balance', data: balanceData, borderColor:'#2b6ba8', backgroundColor:'transparent', tension:0.2, pointRadius:2},
        {label:'Interest', data: interestData, borderColor:'#5db85d', backgroundColor:'transparent', tension:0.2, pointRadius:2},
        {label:'Payment', data: paymentData, borderColor:'#d14b4b', backgroundColor:'transparent', tension:0.2, pointRadius:2}
      ]
    },
    options: {
      responsive:true,
      maintainAspectRatio:false,
      scales:{y:{beginAtZero:true}},
      plugins:{legend:{position:'top'}}
    }
  });
  // constrain canvas height for responsive layout
  document.getElementById('loanChart').style.height = '220px';
}

/* Render annual summary by grouping months into years */
function renderAnnual(schedule, currency){
  scheduleTableBody.innerHTML = '';
  const monthsPerYear = 12;
  const years = Math.ceil(schedule.length / monthsPerYear);
  for(let y=0;y<years;y++){
    const start = y*monthsPerYear;
    const chunk = schedule.slice(start, start+monthsPerYear);
    const yearIndex = y+1;
    let sumInterest = 0, sumPrincipal = 0, endingBalance = 0;
    chunk.forEach(row => { sumInterest += row.interest; sumPrincipal += row.principal; endingBalance = row.balance; });
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>Year ${yearIndex}</td>
                    <td>${formatCurrency(sumInterest, currency)}</td>
                    <td>${formatCurrency(sumPrincipal, currency)}</td>
                    <td>${formatCurrency(endingBalance, currency)}</td>`;
    scheduleTableBody.appendChild(tr);
  }
}

/* Render monthly schedule full */
function renderMonthly(schedule, currency){
  scheduleTableBody.innerHTML = '';
  schedule.forEach(row=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>Month ${row.period}</td>
                    <td>${formatCurrency(row.interest, currency)}</td>
                    <td>${formatCurrency(row.principal, currency)}</td>
                    <td>${formatCurrency(row.balance, currency)}</td>`;
    scheduleTableBody.appendChild(tr);
  });
}

/* build amortization schedule array for CSV or table functions */
function buildSchedule(){
  const P_price = parseFloat(amountEl.value) || 0;
  const months = Math.max(1, parseInt(monthsEl.value) || 0);
  const annualRate = parseFloat(rateEl.value) || 0;
  const monthlyRate = annualRate/100/12;
  const cash = parseFloat(cashEl.value) || 0;
  const down = parseFloat(downEl.value) || 0;
  const trade = parseFloat(tradeEl.value) || 0;
  const owed = parseFloat(owedEl.value) || 0;
  const taxPercent = parseFloat(salesTaxEl.value) || 0;
  const fees = parseFloat(feesEl.value) || 0;

  const netPrice = P_price - cash - down - trade + owed;
  const taxAmount = (taxPercent/100) * P_price;
  const loanAmount = Math.max(0, netPrice + taxAmount + fees);

  let monthlyPayment;
  if(monthlyRate === 0) monthlyPayment = loanAmount / months;
  else monthlyPayment = loanAmount * (monthlyRate / (1 - Math.pow(1 + monthlyRate, -months)));

  const schedule = [];
  let balance = loanAmount;
  for(let m=1;m<=months;m++){
    let interest = balance * monthlyRate;
    let principal = monthlyPayment - interest;
    if(m===months){
      principal = balance;
      monthlyPayment = principal + interest;
    }
    balance = Math.max(0, balance - principal);
    schedule.push({period:m,interest,principal,balance,payment:monthlyPayment});
  }
  return {schedule,loanAmount,monthlyPayment};
}

/* CSV download */
function downloadCSV(){
  const currency = currencyEl.value || 'USD';
  const {schedule,loanAmount,monthlyPayment} = buildSchedule();
  let csv = 'Period,Interest,Principal,Payment,Ending Balance\n';
  schedule.forEach(r=>{
    csv += `${r.period},${r.interest.toFixed(2)},${r.principal.toFixed(2)},${r.payment.toFixed(2)},${r.balance.toFixed(2)}\n`;
  });
  const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'autoloan_schedule.csv';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

/* event handlers */
calcBtn.addEventListener('click', calculateAndRender);
resetBtn.addEventListener('click', ()=>{
  amountEl.value = 50000; monthsEl.value = 60; rateEl.value = 5; cashEl.value = 0;
  downEl.value = 10000; tradeEl.value = 0; owedEl.value = 0; salesTaxEl.value = 7; feesEl.value = 2000;
  calculateAndRender();
});
printBtn.addEventListener('click', ()=>{
  window.print();
});
csvBtn.addEventListener('click', downloadCSV);

/* tabs */
document.getElementById('tabAnnual').addEventListener('click', ()=>{
  document.getElementById('tabAnnual').classList.add('active');
  document.getElementById('tabMonthly').classList.remove('active');
  // rebuild schedule
  const {schedule} = buildSchedule();
  renderAnnual(schedule, currencyEl.value);
});
document.getElementById('tabMonthly').addEventListener('click', ()=>{
  document.getElementById('tabMonthly').classList.add('active');
  document.getElementById('tabAnnual').classList.remove('active');
  const {schedule} = buildSchedule();
  renderMonthly(schedule, currencyEl.value);
});

/* currency change refresh formatting for outputs */
currencyEl.addEventListener('change', calculateAndRender);

/* auto-run once */
window.addEventListener('load', calculateAndRender);
</script>
</body>
</html>
