<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Auto / Mortgage Loan Calculator — Fixvity</title>

<style>
  /* Basic reset + mobile-friendly touch */
  :root{ --accent:#1976d2; --muted:#6b7280; --card:#f6fbff; --bg:#ffffff; --radius:10px; }
  *{ box-sizing:border-box; }
  html,body{ height:100%; margin:0; padding:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:#111; touch-action: pan-y; -webkit-font-smoothing:antialiased; }
  a{ color:var(--accent); text-decoration:none; }

  /* page container */
  .wrap{ max-width:980px; margin:18px auto; padding:18px; }

  header{ margin-bottom:14px; }
  h1{ margin:0 0 6px; font-size:28px; color:var(--accent); }
  p.lead{ margin:0 0 18px; color:var(--muted); font-size:14px; }

  /* card */
  .card{ background:var(--card); border-radius:var(--radius); padding:14px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }

  /* form grid */
  .grid{ display:grid; gap:12px; grid-template-columns: 1fr; }
  .row{ display:flex; gap:12px; align-items:center; }
  .col{ flex:1; }
  label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
  input[type="number"], input[type="text"], select { width:100%; padding:10px 12px; border:1px solid #e6e9ee; border-radius:8px; font-size:14px; background:#fff; }
  button.btn{ padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600; background:var(--accent); color:#fff; }
  button.secondary{ background:#fff; color:var(--accent); border:1px solid #e6e9ee; }

  /* responsive layout for form groups */
  .two{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  .three{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px; }

  /* small helper text */
  .muted{ color:var(--muted); font-size:13px; margin-top:8px; }

  /* Results */
  .results{ margin-top:14px; display:grid; grid-template-columns: 1fr 1fr; gap:12px; align-items:center; }
  .stat{ background:#fff; padding:12px; border-radius:8px; border:1px solid #f0f4f8; }
  .stat h3{ margin:0; font-size:18px; color:var(--accent); }
  .stat p{ margin:6px 0 0; color:var(--muted); font-size:13px; }

  /* amortization table: allow internal horizontal scroll */
  .table-wrap{ margin-top:16px; overflow:auto; -webkit-overflow-scrolling:touch; border-radius:8px; box-shadow:0 6px 12px rgba(0,0,0,0.03); }
  table{ width:100%; border-collapse:collapse; min-width:800px; background:#fff; }
  th, td{ padding:10px 12px; border-bottom:1px solid #f0f4f8; text-align:left; font-size:13px; }
  th{ background:#fafcff; color:#333; position:sticky; top:0; z-index:2; }

  /* control widths on very small screens */
  @media(max-width:700px){
    .two{ grid-template-columns: 1fr; }
    .three{ grid-template-columns: 1fr; }
    .results{ grid-template-columns: 1fr; }
    h1{ font-size:22px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Auto / Mortgage Loan Calculator</h1>
      <p class="lead">Monthly payment, amortization schedule, extra payments and printable results. Embedded friendly for mobile — horizontal table will scroll inside the page.</p>
    </header>

    <div class="card" id="calculatorCard">
      <form id="calcForm" onsubmit="return false;">
        <div class="grid">
          <div class="two">
            <div>
              <label for="amount">Loan amount</label>
              <input id="amount" type="number" step="1" min="0" value="400000">
            </div>
            <div>
              <label for="down">Down payment (%)</label>
              <input id="down" type="number" step="0.1" min="0" max="100" value="20">
            </div>
          </div>

          <div class="two">
            <div>
              <label for="years">Loan term (years)</label>
              <input id="years" type="number" min="0" step="1" value="30">
            </div>
            <div>
              <label for="rate">Interest rate (%)</label>
              <input id="rate" type="number" min="0" step="0.001" value="6.228">
            </div>
          </div>

          <div class="two">
            <div>
              <label for="freq">Payments per year</label>
              <select id="freq">
                <option value="12">Monthly (12)</option>
                <option value="26">Biweekly (26)</option>
                <option value="52">Weekly (52)</option>
                <option value="1">Yearly (1)</option>
              </select>
            </div>
            <div>
              <label for="startMonth">Start month</label>
              <select id="startMonth">
                <option>Jan</option><option>Feb</option><option>Mar</option><option>Apr</option>
                <option>May</option><option>Jun</option><option>Jul</option><option>Aug</option>
                <option>Sep</option><option>Oct</option><option>Nov</option><option>Dec</option>
              </select>
            </div>
          </div>

          <div class="three">
            <div>
              <label for="extraMonthly">Extra monthly</label>
              <input id="extraMonthly" type="number" step="1" min="0" value="0">
            </div>
            <div>
              <label for="extraYearly">Extra yearly</label>
              <input id="extraYearly" type="number" step="1" min="0" value="0">
            </div>
            <div>
              <label for="oneTime">Extra one-time</label>
              <input id="oneTime" type="number" step="1" min="0" value="0">
            </div>
          </div>

          <div class="two" style="align-items:center;">
            <div>
              <button class="btn" id="calcBtn" type="button">Calculate</button>
              <button class="secondary" id="resetBtn" type="button" style="margin-left:8px;">Reset</button>
            </div>
            <div style="text-align:right;">
              <label style="display:block;color:var(--muted);font-size:13px;margin-bottom:6px;">Actions</label>
              <button id="printBtn" type="button" class="secondary" onclick="window.print()">Print</button>
            </div>
          </div>
        </div>
      </form>

      <!-- results area -->
      <div class="results" id="results" aria-live="polite" style="display:none;">
        <div class="stat">
          <h3 id="monthlyDisplay">$0.00</h3>
          <p class="muted">Monthly payment</p>
        </div>
        <div class="stat">
          <h3 id="summaryDisplay">0 years</h3>
          <p class="muted">Loan length (after extras)</p>
        </div>
      </div>

      <div class="table-wrap" id="amortWrap" style="display:none;">
        <table id="amortTable" role="table" aria-label="Amortization schedule">
          <thead>
            <tr>
              <th>#</th>
              <th>Date</th>
              <th>Payment</th>
              <th>Principal</th>
              <th>Interest</th>
              <th>Extra</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
/* Utility: format as currency */
function money(v){ return v===0? '$0.00' : '$' + Number(v).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}); }

/* Main calculation */
function calculateSchedule(){
  const amount = Number(document.getElementById('amount').value) || 0;
  const down = Number(document.getElementById('down').value) || 0;
  const years = Number(document.getElementById('years').value) || 0;
  const rate = Number(document.getElementById('rate').value) || 0;
  const freq = Number(document.getElementById('freq').value) || 12;
  const extraMonthly = Number(document.getElementById('extraMonthly').value) || 0;
  const extraYearly = Number(document.getElementById('extraYearly').value) || 0;
  const oneTime = Number(document.getElementById('oneTime').value) || 0;
  const startMonth = document.getElementById('startMonth').selectedIndex || 0;

  // principal after down payment %
  const principal = amount - (amount * (down/100));
  if (principal <= 0 || years <= 0){ alert('Please enter loan amount and term.'); return; }

  // periodic interest rate
  const periods = years * freq;
  const periodicRate = (rate/100) / freq;

  // base payment (if rate=0, handle separately)
  let payment;
  if (periodicRate === 0) {
    payment = principal / periods;
  } else {
    payment = principal * (periodicRate) / (1 - Math.pow(1 + periodicRate, -periods));
  }

  // build amortization schedule
  const tbody = document.querySelector('#amortTable tbody');
  tbody.innerHTML = '';
  let balance = principal;
  let currentDate = new Date();
  currentDate.setMonth(currentDate.getMonth() + startMonth);
  // apply oneTime at first payment (you can change where oneTime applies)
  let extraThisPeriod = oneTime;
  let totalInterest = 0;
  let monthCount = 0;
  let maxPeriods = 100000; // safety loop limit

  for(let i=1; i<=periods && balance > 0.0001 && maxPeriods-->0; i++){
    monthCount++;
    // interest and principal portion
    const interest = balance * periodicRate;
    let principalPaid = payment - interest;
    // if the payment would overpay the balance, cap it
    if (principalPaid + extraMonthly + extraThisPeriod + (extraYearly && (i % freq === 0) ? extraYearly : 0) > balance) {
      principalPaid = balance;
    }

    // compute extras for this period
    const extraYearlyThis = (extraYearly && (i % freq === 0)) ? extraYearly : 0;
    const totalExtra = (extraMonthly + extraThisPeriod + extraYearlyThis);

    // final payment if balance small
    const pay = Math.max(0, principalPaid + interest);

    // update totals
    totalInterest += interest;
    balance = Math.max(0, balance - principalPaid - totalExtra);

    // row date text
    const rowDate = new Date(currentDate.getTime());
    const rowDateStr = rowDate.toLocaleString(undefined, { month: 'short', year: 'numeric' });

    // append row
    const tr = document.createElement('tr');
    tr.innerHTML = '<td>'+i+'</td>' +
                   '<td>'+rowDateStr+'</td>' +
                   '<td>'+money(pay + totalExtra)+'</td>' +
                   '<td>'+money(principalPaid)+'</td>' +
                   '<td>'+money(interest)+'</td>' +
                   '<td>'+money(totalExtra)+'</td>' +
                   '<td>'+money(balance)+'</td>';
    tbody.appendChild(tr);

    // move date forward
    // advance by approximate period: for monthly (12) add 1 month; for 26/52 we add 14/7 days roughly
    if (freq === 12) currentDate.setMonth(currentDate.getMonth()+1);
    else if (freq === 26) currentDate.setDate(currentDate.getDate()+14);
    else if (freq === 52) currentDate.setDate(currentDate.getDate()+7);
    else currentDate.setFullYear(currentDate.getFullYear() + (1/freq));

    // reset oneTime after first use
    extraThisPeriod = 0;

    // safety: break if too many iterations
    if(i>10000) break;
  }

  // show results
  document.getElementById('monthlyDisplay').textContent = money(payment + extraMonthly);
  const yearsTaken = (monthCount / freq).toFixed(2);
  document.getElementById('summaryDisplay').textContent = yearsTaken + ' years (' + monthCount + ' payments)';
  document.getElementById('results').style.display = 'grid';
  document.getElementById('amortWrap').style.display = 'block';
  // scroll amort to top
  document.getElementById('amortWrap').scrollLeft = 0;
}

/* Wiring */
document.getElementById('calcBtn').addEventListener('click', calculateSchedule);
document.getElementById('resetBtn').addEventListener('click', function(){
  document.getElementById('amount').value = 400000;
  document.getElementById('down').value = 20;
  document.getElementById('years').value = 30;
  document.getElementById('rate').value = 6.228;
  document.getElementById('freq').value = 12;
  document.getElementById('extraMonthly').value = 0;
  document.getElementById('extraYearly').value = 0;
  document.getElementById('oneTime').value = 0;
  document.getElementById('results').style.display = 'none';
  document.getElementById('amortWrap').style.display = 'none';
});

/* accessibility: press Enter to calculate when focusing an input */
['amount','years','rate','down','extraMonthly','extraYearly','oneTime'].forEach(id=>{
  document.getElementById(id).addEventListener('keydown', function(e){ if(e.key === 'Enter') calculateSchedule(); });
});
</script>
</body>
</html>
